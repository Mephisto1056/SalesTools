<template>
  <div class="self-test">
    <!-- é¡µé¢å¤´éƒ¨ -->
    <section class="page-header">
      <div class="header-container">
        <div class="header-content">
          <div class="header-badge animate-fade-in-up">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12l2 2 4-4"/>
              <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
              <path d="M3 12c1 0 3-1-3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
              <path d="M3 12h6m6 0h6"/>
            </svg>
            <span>èƒ½åŠ›è¯„ä¼°å·¥å…·</span>
          </div>
          
          <h1 class="page-title animate-fade-in-up">é”€å”®è¾…å¯¼èƒ½åŠ›è¯„ä¼°</h1>
          <p class="page-description animate-fade-in-up">
            é€šè¿‡ç§‘å­¦çš„è¯„ä¼°ä½“ç³»ï¼Œå…¨é¢äº†è§£æ‚¨çš„é”€å”®è¾…å¯¼èƒ½åŠ›æ°´å¹³ï¼Œ
            å¹¶è·å¾—ä¸ªæ€§åŒ–çš„æ”¹è¿›å»ºè®®å’Œè¡ŒåŠ¨è®¡åˆ’ã€‚
          </p>
          
          <div class="assessment-info animate-fade-in-up">
            <div class="info-item">
              <span class="info-label">è¯„ä¼°ç»´åº¦</span>
              <span class="info-value">4ä¸ªæ ¸å¿ƒç»´åº¦</span>
            </div>
            <div class="info-item">
              <span class="info-label">è¯„ä¼°é¢˜ç›®</span>
              <span class="info-value">40é“ä¸“ä¸šé¢˜ç›®</span>
            </div>
            <div class="info-item">
              <span class="info-label">è¯„ä¼°æ—¶é—´</span>
              <span class="info-value">çº¦8-10åˆ†é’Ÿ</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- è¯„ä¼°è¡¨å•åŒºåŸŸ -->
    <section class="assessment-section">
      <div class="section-container">
        <div class="assessment-form">
          <!-- Trust ç»´åº¦ -->
          <div class="dimension-card animate-fade-in-up">
            <div class="dimension-header">
              <div class="dimension-icon trust">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                </svg>
              </div>
              <div class="dimension-title">
                <h2>Trustï¼ˆä¿¡ä»»å»ºè®¾ï¼‰</h2>
                <p>è¯„ä¼°æ‚¨å»ºç«‹ä¿¡ä»»ç¯å¢ƒå’Œå®‰å…¨æ²Ÿé€šçš„èƒ½åŠ›</p>
              </div>
            </div>

            <!-- ä¿¡ä»»ç¯å¢ƒåˆ›å»ºèƒ½åŠ› -->
            <div class="subsection">
              <h3 class="subsection-title">ä¿¡ä»»ç¯å¢ƒåˆ›å»ºèƒ½åŠ›</h3>
              <div class="question-group">
                <div v-for="(question, index) in trustQuestions.environment" :key="index" class="question-item">
                  <label class="question-label">{{ question }}</label>
                  <div class="rating-group">
                    <label v-for="score in 5" :key="score" class="rating-option">
                      <input 
                        type="radio" 
                        :name="`trust_env_${index}`" 
                        :value="score"
                        v-model="scores.trust.environment[index]"
                      />
                      <span class="rating-button">{{ score }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- å®‰å…¨æ²Ÿé€šå»ºç«‹ -->
            <div class="subsection">
              <h3 class="subsection-title">å®‰å…¨æ²Ÿé€šå»ºç«‹</h3>
              <div class="question-group">
                <div v-for="(question, index) in trustQuestions.communication" :key="index" class="question-item">
                  <label class="question-label">{{ question }}</label>
                  <div class="rating-group">
                    <label v-for="score in 5" :key="score" class="rating-option">
                      <input 
                        type="radio" 
                        :name="`trust_comm_${index}`" 
                        :value="score"
                        v-model="scores.trust.communication[index]"
                      />
                      <span class="rating-button">{{ score }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Connect ç»´åº¦ -->
          <div class="dimension-card animate-fade-in-up">
            <div class="dimension-header">
              <div class="dimension-icon connect">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                  <circle cx="9" cy="7" r="4"/>
                  <path d="m22 2-5 10-5-5 10-5z"/>
                </svg>
              </div>
              <div class="dimension-title">
                <h2>Connectï¼ˆæ·±åº¦è¿æ¥ï¼‰</h2>
                <p>è¯„ä¼°æ‚¨çš„éœ€æ±‚æ´å¯Ÿå’Œæ·±åº¦å¯¹è¯æŠ€å·§</p>
              </div>
            </div>

            <!-- éœ€æ±‚æ´å¯Ÿèƒ½åŠ› -->
            <div class="subsection">
              <h3 class="subsection-title">éœ€æ±‚æ´å¯Ÿèƒ½åŠ›</h3>
              <div class="question-group">
                <div v-for="(question, index) in connectQuestions.insight" :key="index" class="question-item">
                  <label class="question-label">{{ question }}</label>
                  <div class="rating-group">
                    <label v-for="score in 5" :key="score" class="rating-option">
                      <input 
                        type="radio" 
                        :name="`connect_insight_${index}`" 
                        :value="score"
                        v-model="scores.connect.insight[index]"
                      />
                      <span class="rating-button">{{ score }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- æ·±åº¦å¯¹è¯æŠ€å·§ -->
            <div class="subsection">
              <h3 class="subsection-title">æ·±åº¦å¯¹è¯æŠ€å·§</h3>
              <div class="question-group">
                <div v-for="(question, index) in connectQuestions.dialogue" :key="index" class="question-item">
                  <label class="question-label">{{ question }}</label>
                  <div class="rating-group">
                    <label v-for="score in 5" :key="score" class="rating-option">
                      <input 
                        type="radio" 
                        :name="`connect_dialogue_${index}`" 
                        :value="score"
                        v-model="scores.connect.dialogue[index]"
                      />
                      <span class="rating-button">{{ score }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Enable ç»´åº¦ -->
          <div class="dimension-card animate-fade-in-up">
            <div class="dimension-header">
              <div class="dimension-icon enable">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect width="18" height="11" x="3" y="11" rx="2" ry="2"/>
                  <path d="m7 11V7a5 5 0 0 1 10 0v4"/>
                </svg>
              </div>
              <div class="dimension-title">
                <h2>Enableï¼ˆç²¾å‡†èµ‹èƒ½ï¼‰</h2>
                <p>è¯„ä¼°æ‚¨çš„ä¸ªæ€§åŒ–æ”¯æŒå’Œèƒ½åŠ›å»ºè®¾æ•ˆæœ</p>
              </div>
            </div>

            <!-- ä¸ªæ€§åŒ–æ”¯æŒèƒ½åŠ› -->
            <div class="subsection">
              <h3 class="subsection-title">ä¸ªæ€§åŒ–æ”¯æŒèƒ½åŠ›</h3>
              <div class="question-group">
                <div v-for="(question, index) in enableQuestions.support" :key="index" class="question-item">
                  <label class="question-label">{{ question }}</label>
                  <div class="rating-group">
                    <label v-for="score in 5" :key="score" class="rating-option">
                      <input 
                        type="radio" 
                        :name="`enable_support_${index}`" 
                        :value="score"
                        v-model="scores.enable.support[index]"
                      />
                      <span class="rating-button">{{ score }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- èƒ½åŠ›å»ºè®¾æ•ˆæœ -->
            <div class="subsection">
              <h3 class="subsection-title">èƒ½åŠ›å»ºè®¾æ•ˆæœ</h3>
              <div class="question-group">
                <div v-for="(question, index) in enableQuestions.effectiveness" :key="index" class="question-item">
                  <label class="question-label">{{ question }}</label>
                  <div class="rating-group">
                    <label v-for="score in 5" :key="score" class="rating-option">
                      <input 
                        type="radio" 
                        :name="`enable_effect_${index}`" 
                        :value="score"
                        v-model="scores.enable.effectiveness[index]"
                      />
                      <span class="rating-button">{{ score }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Develop ç»´åº¦ -->
          <div class="dimension-card animate-fade-in-up">
            <div class="dimension-header">
              <div class="dimension-icon develop">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                  <path d="m2 17 10 5 10-5"/>
                  <path d="m2 12 10 5 10-5"/>
                </svg>
              </div>
              <div class="dimension-title">
                <h2>Developï¼ˆæŒç»­å‘å±•ï¼‰</h2>
                <p>è¯„ä¼°æ‚¨çš„è‡ªä¸»æˆé•¿åŸ¹å…»å’Œèƒ½åŠ›ä¼ æ‰¿å»ºè®¾</p>
              </div>
            </div>

            <!-- è‡ªä¸»æˆé•¿åŸ¹å…» -->
            <div class="subsection">
              <h3 class="subsection-title">è‡ªä¸»æˆé•¿åŸ¹å…»</h3>
              <div class="question-group">
                <div v-for="(question, index) in developQuestions.growth" :key="index" class="question-item">
                  <label class="question-label">{{ question }}</label>
                  <div class="rating-group">
                    <label v-for="score in 5" :key="score" class="rating-option">
                      <input 
                        type="radio" 
                        :name="`develop_growth_${index}`" 
                        :value="score"
                        v-model="scores.develop.growth[index]"
                      />
                      <span class="rating-button">{{ score }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- èƒ½åŠ›ä¼ æ‰¿å»ºè®¾ -->
            <div class="subsection">
              <h3 class="subsection-title">èƒ½åŠ›ä¼ æ‰¿å»ºè®¾</h3>
              <div class="question-group">
                <div v-for="(question, index) in developQuestions.inheritance" :key="index" class="question-item">
                  <label class="question-label">{{ question }}</label>
                  <div class="rating-group">
                    <label v-for="score in 5" :key="score" class="rating-option">
                      <input 
                        type="radio" 
                        :name="`develop_inherit_${index}`" 
                        :value="score"
                        v-model="scores.develop.inheritance[index]"
                      />
                      <span class="rating-button">{{ score }}</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- æäº¤æŒ‰é’® -->
          <div class="submit-section">
            <div class="progress-info">
              <span class="progress-text">å®Œæˆè¿›åº¦ï¼š{{ completionPercentage }}%</span>
              <div class="progress-bar">
                <div class="progress-fill" :style="{ width: completionPercentage + '%' }"></div>
              </div>
            </div>
            
            <button 
              class="btn btn-primary btn-lg"
              @click="submitAssessment"
              :disabled="!isFormComplete || isLoading"
            >
              <svg v-if="isLoading" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="animate-spin">
                <path d="M21 12a9 9 0 11-6.219-8.56"/>
              </svg>
              <svg v-else width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"/>
                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                <path d="M3 12c1 0 3-1-3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                <path d="M3 12h6m6 0h6"/>
              </svg>
              {{ isLoading ? 'æ­£åœ¨åˆ†æä¸­...' : 'æäº¤è¯„ä¼°' }}
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
    <section v-if="showResult" class="results-section">
      <div class="section-container">
        <!-- æ€»ä½“è¯„åˆ† -->
        <div class="result-card animate-fade-in-up">
          <div class="card-header">
            <div class="card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"/>
                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                <path d="M3 12c1 0 3-1-3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                <path d="M3 12h6m6 0h6"/>
              </svg>
            </div>
            <div class="card-title">
              <h3>è¯„ä¼°ç»“æœ</h3>
              <p>æ‚¨çš„é”€å”®è¾…å¯¼èƒ½åŠ›ç»¼åˆè¯„ä¼°æŠ¥å‘Š</p>
            </div>
          </div>
          
          <div class="score-summary">
            <div class="total-score">
              <div class="score-circle">
                <span class="score-number">{{ totalScore }}</span>
                <span class="score-total">/ 200</span>
              </div>
              <div class="score-info">
                <h4>æ€»ä½“è¯„åˆ†</h4>
                <div class="level-badge" :class="levelClass">{{ levelText }}</div>
              </div>
            </div>
            
            <div class="dimension-scores">
              <div class="dimension-score-item">
                <div class="score-header">
                  <span class="dimension-name">Trustï¼ˆä¿¡ä»»å»ºè®¾ï¼‰</span>
                  <span class="score-value">{{ trustScore }} / 50</span>
                </div>
                <div class="score-bar">
                  <div class="score-fill trust" :style="{ width: (trustScore / 50 * 100) + '%' }"></div>
                </div>
              </div>
              
              <div class="dimension-score-item">
                <div class="score-header">
                  <span class="dimension-name">Connectï¼ˆæ·±åº¦è¿æ¥ï¼‰</span>
                  <span class="score-value">{{ connectScore }} / 50</span>
                </div>
                <div class="score-bar">
                  <div class="score-fill connect" :style="{ width: (connectScore / 50 * 100) + '%' }"></div>
                </div>
              </div>
              
              <div class="dimension-score-item">
                <div class="score-header">
                  <span class="dimension-name">Enableï¼ˆç²¾å‡†èµ‹èƒ½ï¼‰</span>
                  <span class="score-value">{{ enableScore }} / 50</span>
                </div>
                <div class="score-bar">
                  <div class="score-fill enable" :style="{ width: (enableScore / 50 * 100) + '%' }"></div>
                </div>
              </div>
              
              <div class="dimension-score-item">
                <div class="score-header">
                  <span class="dimension-name">Developï¼ˆæŒç»­å‘å±•ï¼‰</span>
                  <span class="score-value">{{ developScore }} / 50</span>
                </div>
                <div class="score-bar">
                  <div class="score-fill develop" :style="{ width: (developScore / 50 * 100) + '%' }"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- å¯å‘æŒ¥çš„å¼ºé¡¹ -->
        <div v-if="strengths.length > 0" class="result-card animate-fade-in-up">
          <div class="card-header">
            <div class="card-icon strength-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"/>
                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"/>
                <path d="M3 12c1 0 3-1-3-3s-2-3-3-3-3 1-3 3 2 3 3 3"/>
                <path d="M3 12h6m6 0h6"/>
              </svg>
            </div>
            <div class="card-title">
              <h3>å¯å‘æŒ¥çš„å¼ºé¡¹</h3>
              <p>æ‚¨åœ¨è¿™äº›æ–¹é¢è¡¨ç°ä¼˜ç§€ï¼Œå¯ä»¥è¿›ä¸€æ­¥å‘æŒ¥å’Œè¿ç”¨</p>
            </div>
          </div>
          
          <div class="strength-content">
            <div v-for="strength in strengths" :key="strength.displayName" class="strength-item">
              <div class="strength-header">
                <span class="strength-badge">ä¼˜åŠ¿èƒ½åŠ›</span>
                <h4>{{ strength.displayName }}</h4>
                <span class="strength-score">{{ strength.score }} / 25åˆ†</span>
              </div>
              <p class="strength-description">
                è¿™æ˜¯æ‚¨çš„ä¼˜åŠ¿é¢†åŸŸï¼Œå»ºè®®å°†æ­¤èƒ½åŠ›ä½œä¸ºå›¢é˜Ÿå»ºè®¾å’Œä¸ªäººå‘å±•çš„æ ¸å¿ƒä¼˜åŠ¿ã€‚
              </p>
            </div>
          </div>
        </div>

        <!-- é‡ç‚¹æ”¹è¿›æ–¹å‘ -->
        <div v-if="improvements.length > 0" class="result-card animate-fade-in-up">
          <div class="card-header">
            <div class="card-icon improvement-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <div class="card-title">
              <h3>é‡ç‚¹æ”¹è¿›æ–¹å‘</h3>
              <p>å¾—åˆ†ä½äº18åˆ†çš„å­ç»´åº¦ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨å’Œæå‡</p>
            </div>
          </div>
          
          <div class="improvement-content">
            <div v-for="improvement in improvements" :key="improvement.displayName" class="improvement-item priority-high">
              <div class="improvement-header">
                <span class="priority-badge high">é‡ç‚¹æ”¹è¿›</span>
                <h4>{{ improvement.displayName }}</h4>
                <span class="improvement-score">{{ improvement.score }} / 25åˆ†</span>
              </div>
              <p class="improvement-description">
                è¿™ä¸ªå­ç»´åº¦å¾—åˆ†è¾ƒä½ï¼Œå»ºè®®åˆ¶å®šä¸“é¡¹æå‡è®¡åˆ’ï¼Œé€šè¿‡ç³»ç»Ÿå­¦ä¹ å’Œå®è·µæ¥æ”¹è¿›ã€‚
              </p>
            </div>
          </div>
        </div>

        <!-- ä¸ªæ€§åŒ–çš„é”€å”®è¾…å¯¼èƒ½åŠ›å»ºè®® -->
        <div v-if="aiAnalysis" class="result-card animate-fade-in-up">
          <div class="card-header">
            <div class="card-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <div class="card-title">
              <h3>ä¸ªæ€§åŒ–çš„é”€å”®è¾…å¯¼èƒ½åŠ›å»ºè®®</h3>
              <p>åŸºäºæ‚¨çš„è¯„ä¼°ç»“æœï¼ŒAIç”Ÿæˆçš„ä¸ªæ€§åŒ–èƒ½åŠ›æå‡å»ºè®®</p>
            </div>
          </div>
          
          <div class="analysis-content" v-html="formatAnalysis(aiAnalysis)"></div>
        </div>

        <!-- ä¸ªæ€§åŒ–å»ºè®®å‡çº§ -->
        <div v-if="!showPersonalForm && !isPersonalizing" class="personalization-upgrade animate-fade-in-up">
          <div class="upgrade-card">
            <div class="upgrade-header">
              <div class="upgrade-icon">
                ğŸ¯
              </div>
              <div class="upgrade-content">
                <h3>æƒ³è¦æ›´ç²¾å‡†çš„ä¸ªæ€§åŒ–å»ºè®®å—ï¼Ÿ</h3>
                <p>å‘Šè¯‰æˆ‘ä»¬æ›´å¤šä¿¡æ¯ï¼Œè·å¾—é‡èº«å®šåˆ¶çš„å‘å±•å»ºè®®å’Œè¡ŒåŠ¨æ–¹æ¡ˆ</p>
              </div>
            </div>
            <div class="upgrade-actions">
              <button class="btn btn-primary" @click="showPersonalForm = true">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                è·å–ä¸ªæ€§åŒ–å»ºè®®
              </button>
              <button class="btn btn-secondary">
                æš‚æ—¶è·³è¿‡
              </button>
            </div>
          </div>
        </div>

        <!-- ä¸ªæ€§åŒ–ä¿¡æ¯è¡¨å• -->
        <div v-if="showPersonalForm" class="personalization-form animate-fade-in-up">
          <div class="form-card">
            <div class="form-header">
              <h3>ğŸ“‹ ä¸ªæ€§åŒ–ä¿¡æ¯è¡¥å……</h3>
              <p>è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆæ›´ç²¾å‡†çš„å»ºè®®</p>
            </div>
            
            <div class="form-content">
              <!-- ç®¡ç†ç»éªŒ -->
              <div class="form-group">
                <label class="form-label">æ‚¨çš„ç®¡ç†ç»éªŒï¼š</label>
                <div class="radio-group">
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.experience" value="1å¹´ä»¥ä¸‹" />
                    <span>1å¹´ä»¥ä¸‹</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.experience" value="1-3å¹´" />
                    <span>1-3å¹´</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.experience" value="3-5å¹´" />
                    <span>3-5å¹´</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.experience" value="5å¹´ä»¥ä¸Š" />
                    <span>5å¹´ä»¥ä¸Š</span>
                  </label>
                </div>
              </div>

              <!-- å›¢é˜Ÿè§„æ¨¡ -->
              <div class="form-group">
                <label class="form-label">å›¢é˜Ÿè§„æ¨¡ï¼š</label>
                <div class="radio-group">
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.teamSize" value="5äººä»¥ä¸‹" />
                    <span>5äººä»¥ä¸‹</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.teamSize" value="5-10äºº" />
                    <span>5-10äºº</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.teamSize" value="10-20äºº" />
                    <span>10-20äºº</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.teamSize" value="20äººä»¥ä¸Š" />
                    <span>20äººä»¥ä¸Š</span>
                  </label>
                </div>
              </div>

              <!-- å½“å‰æŒ‘æˆ˜ -->
              <div class="form-group">
                <label class="form-label">å½“å‰æœ€å¤§æŒ‘æˆ˜ï¼šï¼ˆå¯å¤šé€‰ï¼‰</label>
                <div class="checkbox-group">
                  <label class="checkbox-option">
                    <input type="checkbox" @change="toggleChallenge('å›¢é˜Ÿæ¿€åŠ±')" />
                    <span>å›¢é˜Ÿæ¿€åŠ±</span>
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" @change="toggleChallenge('ä¸šç»©æå‡')" />
                    <span>ä¸šç»©æå‡</span>
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" @change="toggleChallenge('äººå‘˜æµå¤±')" />
                    <span>äººå‘˜æµå¤±</span>
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" @change="toggleChallenge('æ²Ÿé€šåè°ƒ')" />
                    <span>æ²Ÿé€šåè°ƒ</span>
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" @change="toggleChallenge('æŠ€èƒ½åŸ¹å…»')" />
                    <span>æŠ€èƒ½åŸ¹å…»</span>
                  </label>
                  <label class="checkbox-option">
                    <input type="checkbox" @change="toggleChallenge('å…¶ä»–')" />
                    <span>å…¶ä»–</span>
                  </label>
                </div>
              </div>

              <!-- é‡ç‚¹æå‡ -->
              <div class="form-group">
                <label class="form-label">å¸Œæœ›é‡ç‚¹æå‡ï¼š</label>
                <div class="radio-group">
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.focusArea" value="ä¿¡ä»»å»ºè®¾" />
                    <span>ä¿¡ä»»å»ºè®¾</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.focusArea" value="æ·±åº¦è¿æ¥" />
                    <span>æ·±åº¦è¿æ¥</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.focusArea" value="ç²¾å‡†èµ‹èƒ½" />
                    <span>ç²¾å‡†èµ‹èƒ½</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.focusArea" value="æŒç»­å‘å±•" />
                    <span>æŒç»­å‘å±•</span>
                  </label>
                </div>
              </div>

              <!-- å­¦ä¹ åå¥½ -->
              <div class="form-group">
                <label class="form-label">å­¦ä¹ åå¥½ï¼š</label>
                <div class="radio-group">
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.learningStyle" value="ç†è®ºå­¦ä¹ " />
                    <span>ç†è®ºå­¦ä¹ </span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.learningStyle" value="å®è·µæ“ä½œ" />
                    <span>å®è·µæ“ä½œ</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.learningStyle" value="æ¡ˆä¾‹åˆ†æ" />
                    <span>æ¡ˆä¾‹åˆ†æ</span>
                  </label>
                  <label class="radio-option">
                    <input type="radio" v-model="personalInfo.learningStyle" value="åŒä¼´äº¤æµ" />
                    <span>åŒä¼´äº¤æµ</span>
                  </label>
                </div>
              </div>
            </div>

            <div class="form-actions">
              <button
                class="btn btn-primary"
                @click="submitPersonalizedAnalysis"
                :disabled="isPersonalizing"
              >
                <svg v-if="isPersonalizing" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="animate-spin">
                  <path d="M21 12a9 9 0 11-6.219-8.56"/>
                </svg>
                <svg v-else width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                {{ isPersonalizing ? 'æ­£åœ¨ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®...' : 'ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®' }}
              </button>
              <button class="btn btn-secondary" @click="showPersonalForm = false">
                è¿”å›åŸºç¡€ç»“æœ
              </button>
            </div>
          </div>
        </div>

        <!-- ä¸ªæ€§åŒ–å»ºè®®ç»“æœ -->
        <div v-if="personalizedAnalysis" class="result-card animate-fade-in-up">
          <div class="card-header">
            <div class="card-icon personalized-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
            </div>
            <div class="card-title">
              <h3>ğŸ¯ ä¸“å±ä¸ªæ€§åŒ–å»ºè®®</h3>
              <p>åŸºäºæ‚¨çš„ä¸ªäººä¿¡æ¯å’Œè¯„ä¼°ç»“æœï¼Œä¸ºæ‚¨é‡èº«å®šåˆ¶çš„å‘å±•å»ºè®®</p>
            </div>
          </div>
          
          <div class="analysis-content personalized-content" v-html="formatAnalysis(personalizedAnalysis)"></div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-section">
          <button class="btn btn-secondary" @click="resetAssessment">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
              <path d="M21 3v5h-5"/>
              <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
              <path d="M3 21v-5h5"/>
            </svg>
            é‡æ–°æµ‹è¯•
          </button>
        </div>
      </div>
    </section>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue';
import { request } from '../api';

// é—®é¢˜æ•°æ®
const trustQuestions = {
  environment: [
    'æˆ‘çš„å›¢é˜Ÿæˆå‘˜é‡åˆ°å›°éš¾æ—¶ï¼Œä¼šä¸»åŠ¨å‘æˆ‘å¯»æ±‚å¸®åŠ©',
    'å›¢é˜Ÿæˆå‘˜åœ¨æˆ‘é¢å‰æ•¢äºæ‰¿è®¤é”™è¯¯å’Œå¤±è´¥',
    'æˆ‘èƒ½å¤Ÿæ§åˆ¶æƒ…ç»ªï¼Œä¸åœ¨å‹åŠ›ä¸‹æ‰¹è¯„æŒ‡è´£å›¢é˜Ÿ',
    'æˆ‘è¯´åˆ°åšåˆ°ï¼Œå›¢é˜Ÿä¿¡ä»»æˆ‘çš„æ‰¿è¯º',
    'æˆ‘ä¼šåœ¨å›¢é˜Ÿé¢å‰æ‰¿è®¤è‡ªå·±çš„é”™è¯¯å’Œä¸è¶³'
  ],
  communication: [
    'æˆ‘èƒ½å¤Ÿå€¾å¬å›¢é˜Ÿçš„ä¸åŒæ„è§ï¼Œä¸ä¼šç«‹å³åé©³',
    'æˆ‘ä¼šä¿æŠ¤å›¢é˜Ÿæˆå‘˜åœ¨å®¢æˆ·é¢å‰çš„ä¸“ä¸šå½¢è±¡',
    'å½“å›¢é˜Ÿå¤±è´¥æ—¶ï¼Œæˆ‘å…³æ³¨è§£å†³é—®é¢˜è€Œéè¿½ç©¶è´£ä»»',
    'æˆ‘é¼“åŠ±å›¢é˜Ÿå°è¯•æ–°æ–¹æ³•ï¼Œå³ä½¿å¯èƒ½å¤±è´¥',
    'æˆ‘çš„åŠå…¬å®¤å¯¹å›¢é˜Ÿæˆå‘˜æ˜¯å¼€æ”¾çš„'
  ]
};

const connectQuestions = {
  insight: [
    'æˆ‘äº†è§£æ¯ä¸ªå›¢é˜Ÿæˆå‘˜å½“å‰é¢ä¸´çš„å…·ä½“é”€å”®æŒ‘æˆ˜',
    'æˆ‘çŸ¥é“æ¯ä¸ªå›¢é˜Ÿæˆå‘˜çš„èŒä¸šå‘å±•æ„æ„¿å’Œç›®æ ‡',
    'æˆ‘èƒ½è¯†åˆ«å›¢é˜Ÿæˆå‘˜è¡¨é¢é—®é¢˜èƒŒåçš„æ·±å±‚åŸå› ',
    'æˆ‘äº†è§£æ¯ä¸ªå›¢é˜Ÿæˆå‘˜çš„èƒ½åŠ›ä¼˜åŠ¿å’ŒçŸ­æ¿',
    'æˆ‘çŸ¥é“æ¯ä¸ªå›¢é˜Ÿæˆå‘˜æœ€æ‹…å¿ƒå’Œé¡¾è™‘çš„äº‹æƒ…'
  ],
  dialogue: [
    'æˆ‘ä¼šç”¨å¼€æ”¾æ€§é—®é¢˜å¼•å¯¼å›¢é˜Ÿæˆå‘˜æ·±å…¥æ€è€ƒ',
    'æˆ‘èƒ½å¤Ÿè€å¿ƒå€¾å¬ï¼Œä¸æ€¥äºç»™å‡ºå»ºè®®å’ŒæŒ‡å¯¼',
    'æˆ‘ä¼šå…³æ³¨å›¢é˜Ÿæˆå‘˜çš„æƒ…ç»ªå’Œæ„Ÿå—å˜åŒ–',
    'æˆ‘èƒ½å¤Ÿé€šè¿‡æé—®å¸®åŠ©å›¢é˜Ÿæˆå‘˜è‡ªå·±æ‰¾åˆ°ç­”æ¡ˆ',
    'æˆ‘å®šæœŸä¸å›¢é˜Ÿæˆå‘˜è¿›è¡Œä¸€å¯¹ä¸€æ·±åº¦äº¤æµ'
  ]
};

const enableQuestions = {
  support: [
    'æˆ‘ä¼šé’ˆå¯¹ä¸åŒå›¢é˜Ÿæˆå‘˜çš„ç‰¹ç‚¹æä¾›ä¸åŒçš„æŒ‡å¯¼æ–¹å¼',
    'æˆ‘æœ‰ç³»ç»Ÿçš„å·¥å…·å’Œæ–¹æ³•æ¥å¸®åŠ©å›¢é˜Ÿæå‡æŠ€èƒ½',
    'æˆ‘èƒ½å¤Ÿå°†å¤æ‚çš„é”€å”®æŠ€å·§åˆ†è§£ä¸ºå¯å­¦ä¹ çš„æ­¥éª¤',
    'æˆ‘ä¼šä¸ºå›¢é˜Ÿæˆå‘˜æä¾›å®æˆ˜ç»ƒä¹ å’Œåé¦ˆçš„æœºä¼š',
    'æˆ‘èƒ½å¤Ÿè°ƒåŠ¨å…¬å¸èµ„æºä¸ºå›¢é˜Ÿæä¾›ä¸“ä¸šæ”¯æŒ'
  ],
  effectiveness: [
    'ç»è¿‡æˆ‘çš„è¾…å¯¼ï¼Œå›¢é˜Ÿæˆå‘˜çš„é”€å”®æŠ€èƒ½æœ‰æ˜æ˜¾æå‡',
    'æˆ‘çš„å›¢é˜Ÿæˆå‘˜èƒ½å¤Ÿç‹¬ç«‹å¤„ç†å¤æ‚çš„å®¢æˆ·é—®é¢˜',
    'æˆ‘åŸ¹å…»å‡ºçš„é”€å”®äººå‘˜åœ¨è¡Œä¸šå†…æœ‰è‰¯å¥½å£ç¢‘',
    'æˆ‘çš„è¾…å¯¼æ–¹æ³•è¢«å…¶ä»–é”€å”®ç»ç†å­¦ä¹ å’Œå€Ÿé‰´',
    'æˆ‘èƒ½å¤Ÿå¿«é€Ÿå¸®åŠ©æ–°äººé€‚åº”é”€å”®å·¥ä½œ'
  ]
};

const developQuestions = {
  growth: [
    'æˆ‘çš„å›¢é˜Ÿæˆå‘˜å…·å¤‡è‡ªæˆ‘åæ€å’Œæ€»ç»“çš„ä¹ æƒ¯',
    'å›¢é˜Ÿæˆå‘˜é‡åˆ°æ–°æŒ‘æˆ˜æ—¶ï¼Œä¼šä¸»åŠ¨å¯»æ‰¾è§£å†³æ–¹æ³•',
    'æˆ‘çš„å›¢é˜Ÿå†…éƒ¨æœ‰äº’ç›¸å­¦ä¹ å’Œå¸®åŠ©çš„æ°›å›´',
    'å›¢é˜Ÿæˆå‘˜èƒ½å¤Ÿå°†æˆåŠŸç»éªŒè½¬åŒ–ä¸ºå¯å¤åˆ¶çš„æ–¹æ³•',
    'æˆ‘çš„å›¢é˜ŸæŒç»­äº§ç”Ÿæ–°çš„é”€å”®åˆ›æ–°å’Œçªç ´'
  ],
  inheritance: [
    'æˆ‘åŸ¹å…»çš„ä¼˜ç§€é”€å”®èƒ½å¤ŸæŒ‡å¯¼æ–°åŒäº‹',
    'æˆ‘å»ºç«‹äº†å›¢é˜Ÿç»éªŒåˆ†äº«å’ŒçŸ¥è¯†ä¼ æ‰¿æœºåˆ¶',
    'æˆ‘çš„å›¢é˜Ÿæˆå‘˜å…·å¤‡åŸ¹è®­å’Œæ¼”è®²çš„èƒ½åŠ›',
    'æˆ‘é‡è§†é•¿æœŸèƒ½åŠ›å»ºè®¾è€ŒéçŸ­æœŸä¸šç»©å‹åŠ›',
    'æˆ‘çš„ç®¡ç†æ–¹æ³•åŸ¹å…»å‡ºäº†æœªæ¥çš„é”€å”®é¢†å¯¼è€…'
  ]
};

// è¯„åˆ†æ•°æ®
const scores = ref({
  trust: {
    environment: Array(5).fill(null),
    communication: Array(5).fill(null)
  },
  connect: {
    insight: Array(5).fill(null),
    dialogue: Array(5).fill(null)
  },
  enable: {
    support: Array(5).fill(null),
    effectiveness: Array(5).fill(null)
  },
  develop: {
    growth: Array(5).fill(null),
    inheritance: Array(5).fill(null)
  }
});

// çŠ¶æ€ç®¡ç†
const isLoading = ref(false);
const showResult = ref(false);
const aiAnalysis = ref('');
const personalizedAnalysis = ref('');
const analysisResult = ref<any>(null);
const showPersonalForm = ref(false);
const isPersonalizing = ref(false);
const personalInfo = ref({
  experience: '',
  teamSize: '',
  challenges: [] as string[],
  focusArea: '',
  learningStyle: ''
});

// è®¡ç®—å±æ€§
const isFormComplete = computed(() => {
  const allScores = [
    ...scores.value.trust.environment,
    ...scores.value.trust.communication,
    ...scores.value.connect.insight,
    ...scores.value.connect.dialogue,
    ...scores.value.enable.support,
    ...scores.value.enable.effectiveness,
    ...scores.value.develop.growth,
    ...scores.value.develop.inheritance
  ];
  return allScores.every(score => score !== null);
});

const completionPercentage = computed(() => {
  const allScores = [
    ...scores.value.trust.environment,
    ...scores.value.trust.communication,
    ...scores.value.connect.insight,
    ...scores.value.connect.dialogue,
    ...scores.value.enable.support,
    ...scores.value.enable.effectiveness,
    ...scores.value.develop.growth,
    ...scores.value.develop.inheritance
  ];
  const completedCount = allScores.filter(score => score !== null).length;
  return Math.round((completedCount / allScores.length) * 100);
});

const trustScore = computed(() => {
  return [...scores.value.trust.environment, ...scores.value.trust.communication]
    .reduce((sum, score) => sum + (score || 0), 0);
});

const connectScore = computed(() => {
  return [...scores.value.connect.insight, ...scores.value.connect.dialogue]
    .reduce((sum, score) => sum + (score || 0), 0);
});

const enableScore = computed(() => {
  return [...scores.value.enable.support, ...scores.value.enable.effectiveness]
    .reduce((sum, score) => sum + (score || 0), 0);
});

const developScore = computed(() => {
  return [...scores.value.develop.growth, ...scores.value.develop.inheritance]
    .reduce((sum, score) => sum + (score || 0), 0);
});

// å­ç»´åº¦å¾—åˆ†è®¡ç®—
const subDimensionScores = computed(() => {
  return {
    trustEnvironment: scores.value.trust.environment.reduce((sum, score) => sum + (score || 0), 0),
    trustCommunication: scores.value.trust.communication.reduce((sum, score) => sum + (score || 0), 0),
    connectInsight: scores.value.connect.insight.reduce((sum, score) => sum + (score || 0), 0),
    connectDialogue: scores.value.connect.dialogue.reduce((sum, score) => sum + (score || 0), 0),
    enableSupport: scores.value.enable.support.reduce((sum, score) => sum + (score || 0), 0),
    enableEffectiveness: scores.value.enable.effectiveness.reduce((sum, score) => sum + (score || 0), 0),
    developGrowth: scores.value.develop.growth.reduce((sum, score) => sum + (score || 0), 0),
    developInheritance: scores.value.develop.inheritance.reduce((sum, score) => sum + (score || 0), 0)
  };
});

// å¼ºé¡¹è¯†åˆ«ï¼ˆå¾—åˆ†>=22åˆ†çš„å­ç»´åº¦ï¼‰
const strengths = computed(() => {
  const dimensionMapping = {
    trustEnvironment: { dimension: 'Trustï¼ˆä¿¡ä»»å»ºè®¾ï¼‰', subDimension: 'ä¿¡ä»»ç¯å¢ƒåˆ›å»ºèƒ½åŠ›' },
    trustCommunication: { dimension: 'Trustï¼ˆä¿¡ä»»å»ºè®¾ï¼‰', subDimension: 'å®‰å…¨æ²Ÿé€šå»ºç«‹' },
    connectInsight: { dimension: 'Connectï¼ˆæ·±åº¦è¿æ¥ï¼‰', subDimension: 'éœ€æ±‚æ´å¯Ÿèƒ½åŠ›' },
    connectDialogue: { dimension: 'Connectï¼ˆæ·±åº¦è¿æ¥ï¼‰', subDimension: 'æ·±åº¦å¯¹è¯æŠ€å·§' },
    enableSupport: { dimension: 'Enableï¼ˆç²¾å‡†èµ‹èƒ½ï¼‰', subDimension: 'ä¸ªæ€§åŒ–æ”¯æŒèƒ½åŠ›' },
    enableEffectiveness: { dimension: 'Enableï¼ˆç²¾å‡†èµ‹èƒ½ï¼‰', subDimension: 'èƒ½åŠ›å»ºè®¾æ•ˆæœ' },
    developGrowth: { dimension: 'Developï¼ˆæŒç»­å‘å±•ï¼‰', subDimension: 'è‡ªä¸»æˆé•¿åŸ¹å…»' },
    developInheritance: { dimension: 'Developï¼ˆæŒç»­å‘å±•ï¼‰', subDimension: 'èƒ½åŠ›ä¼ æ‰¿å»ºè®¾' }
  };
  
  const strengthItems: any[] = [];
  Object.entries(subDimensionScores.value).forEach(([key, score]) => {
    if (score >= 22) {
      const mapping = dimensionMapping[key as keyof typeof dimensionMapping];
      strengthItems.push({
        dimension: mapping.dimension,
        subDimension: mapping.subDimension,
        score: score,
        displayName: `${mapping.dimension} - ${mapping.subDimension}`
      });
    }
  });
  
  return strengthItems.sort((a, b) => b.score - a.score);
});

// æ”¹è¿›é¡¹è¯†åˆ«ï¼ˆå¾—åˆ†<18åˆ†çš„å­ç»´åº¦ï¼‰
const improvements = computed(() => {
  const dimensionMapping = {
    trustEnvironment: { dimension: 'Trustï¼ˆä¿¡ä»»å»ºè®¾ï¼‰', subDimension: 'ä¿¡ä»»ç¯å¢ƒåˆ›å»ºèƒ½åŠ›' },
    trustCommunication: { dimension: 'Trustï¼ˆä¿¡ä»»å»ºè®¾ï¼‰', subDimension: 'å®‰å…¨æ²Ÿé€šå»ºç«‹' },
    connectInsight: { dimension: 'Connectï¼ˆæ·±åº¦è¿æ¥ï¼‰', subDimension: 'éœ€æ±‚æ´å¯Ÿèƒ½åŠ›' },
    connectDialogue: { dimension: 'Connectï¼ˆæ·±åº¦è¿æ¥ï¼‰', subDimension: 'æ·±åº¦å¯¹è¯æŠ€å·§' },
    enableSupport: { dimension: 'Enableï¼ˆç²¾å‡†èµ‹èƒ½ï¼‰', subDimension: 'ä¸ªæ€§åŒ–æ”¯æŒèƒ½åŠ›' },
    enableEffectiveness: { dimension: 'Enableï¼ˆç²¾å‡†èµ‹èƒ½ï¼‰', subDimension: 'èƒ½åŠ›å»ºè®¾æ•ˆæœ' },
    developGrowth: { dimension: 'Developï¼ˆæŒç»­å‘å±•ï¼‰', subDimension: 'è‡ªä¸»æˆé•¿åŸ¹å…»' },
    developInheritance: { dimension: 'Developï¼ˆæŒç»­å‘å±•ï¼‰', subDimension: 'èƒ½åŠ›ä¼ æ‰¿å»ºè®¾' }
  };
  
  const improvementItems: any[] = [];
  Object.entries(subDimensionScores.value).forEach(([key, score]) => {
    if (score < 18) {
      const mapping = dimensionMapping[key as keyof typeof dimensionMapping];
      improvementItems.push({
        dimension: mapping.dimension,
        subDimension: mapping.subDimension,
        score: score,
        displayName: `${mapping.dimension} - ${mapping.subDimension}`
      });
    }
  });
  
  return improvementItems.sort((a, b) => a.score - b.score);
});

const totalScore = computed(() => {
  return trustScore.value + connectScore.value + enableScore.value + developScore.value;
});

const levelText = computed(() => {
  const score = totalScore.value;
  if (score >= 160) return 'ä¼˜ç§€æ•™ç»ƒå‹é”€å”®ç»ç†';
  if (score >= 120) return 'è‰¯å¥½ï¼Œæœ‰è¿›ä¸€æ­¥æå‡ç©ºé—´';
  if (score >= 80) return 'åŸºç¡€æ°´å¹³ï¼Œéœ€è¦ç³»ç»Ÿæ€§æå‡';
  return 'éœ€è¦é‡ç‚¹å…³æ³¨å’Œæ”¹è¿›';
});

const levelClass = computed(() => {
  const score = totalScore.value;
  if (score >= 160) return 'excellent';
  if (score >= 120) return 'good';
  if (score >= 80) return 'basic';
  return 'needs-improvement';
});


// æ–¹æ³•
const submitAssessment = async () => {
  if (!isFormComplete.value) return;
  
  isLoading.value = true;
  
  try {
    const assessmentData = {
      scores: scores.value,
      totalScore: totalScore.value,
      dimensionScores: {
        trust: trustScore.value,
        connect: connectScore.value,
        enable: enableScore.value,
        develop: developScore.value
      }
    };
    
    const response = await request.post<{data: any}>('/self-test/analyze', assessmentData);
    analysisResult.value = response.data;
    aiAnalysis.value = response.data.analysis;
    showResult.value = true;
  } catch (error) {
    console.error('æäº¤è¯„ä¼°å¤±è´¥:', error);
    alert('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•');
  } finally {
    isLoading.value = false;
  }
};

const resetAssessment = () => {
  scores.value = {
    trust: {
      environment: Array(5).fill(null),
      communication: Array(5).fill(null)
    },
    connect: {
      insight: Array(5).fill(null),
      dialogue: Array(5).fill(null)
    },
    enable: {
      support: Array(5).fill(null),
      effectiveness: Array(5).fill(null)
    },
    develop: {
      growth: Array(5).fill(null),
      inheritance: Array(5).fill(null)
    }
  };
  showResult.value = false;
  aiAnalysis.value = '';
  personalizedAnalysis.value = '';
  analysisResult.value = null;
};

const formatAnalysis = (analysis: string) => {
  return analysis.replace(/\n/g, '<br>');
};

// æäº¤ä¸ªæ€§åŒ–åˆ†æ
const submitPersonalizedAnalysis = async () => {
  if (isPersonalizing.value) return;
  
  isPersonalizing.value = true;
  
  try {
    const assessmentData = {
      scores: scores.value,
      totalScore: totalScore.value,
      dimensionScores: {
        trust: trustScore.value,
        connect: connectScore.value,
        enable: enableScore.value,
        develop: developScore.value
      }
    };
    
    const response = await request.post<{data: any}>('/self-test/analyze-personalized', {
      assessment: assessmentData,
      personalInfo: personalInfo.value
    });
    
    analysisResult.value = response.data;
    personalizedAnalysis.value = response.data.analysis;
    showPersonalForm.value = false;
  } catch (error) {
    console.error('ä¸ªæ€§åŒ–åˆ†æå¤±è´¥:', error);
    alert('ä¸ªæ€§åŒ–åˆ†æå¤±è´¥ï¼Œè¯·é‡è¯•');
  } finally {
    isPersonalizing.value = false;
  }
};

// å¤„ç†æŒ‘æˆ˜é€‰æ‹©
const toggleChallenge = (challenge: string) => {
  const index = personalInfo.value.challenges.indexOf(challenge);
  if (index > -1) {
    personalInfo.value.challenges.splice(index, 1);
  } else {
    personalInfo.value.challenges.push(challenge);
  }
};
</script>

<style scoped>
/* ===== é¡µé¢æ•´ä½“å¸ƒå±€ ===== */
.self-test {
  min-height: 100vh;
  background: var(--bg-secondary);
}

/* ===== é¡µé¢å¤´éƒ¨ ===== */
.page-header {
  background: linear-gradient(135deg, var(--primary-50) 0%, var(--primary-100) 100%);
  padding: var(--space-16) 0 var(--space-20);
  position: relative;
  overflow: hidden;
}

.page-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23f97316' fill-opacity='0.05'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
  pointer-events: none;
}

.header-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 var(--space-6);
}

.header-content {
  text-align: center;
  position: relative;
  z-index: 1;
}

.header-badge {
  display: inline-flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  background: var(--primary-500);
  color: white;
  border-radius: var(--radius-2xl);
  font-size: 0.875rem;
  font-weight: 500;
  margin-bottom: var(--space-6);
  animation-delay: 0.1s;
}

.page-title {
  font-size: 3rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: var(--space-4);
  animation-delay: 0.2s;
}

.page-description {
  font-size: 1.125rem;
  color: var(--text-secondary);
  max-width: 600px;
  margin: 0 auto var(--space-8);
  line-height: 1.6;
  animation-delay: 0.3s;
}

.assessment-info {
  display: flex;
  justify-content: center;
  gap: var(--space-8);
  flex-wrap: wrap;
  animation-delay: 0.4s;
}

.info-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--space-1);
}

.info-label {
  font-size: 0.75rem;
  color: var(--text-tertiary);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.info-value {
  font-size: 1rem;
  color: var(--text-primary);
  font-weight: 600;
}

/* ===== åŒºåŸŸå®¹å™¨ ===== */
.section-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 var(--space-6);
}

/* ===== è¯„ä¼°è¡¨å•åŒºåŸŸ ===== */
.assessment-section {
  padding: var(--space-16) 0;
  margin-top: -var(--space-12);
  position: relative;
  z-index: 2;
}

.assessment-form {
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

/* ===== ç»´åº¦å¡ç‰‡ ===== */
.dimension-card {
  background: var(--bg-primary);
  border-radius: var(--radius-2xl);
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-light);
  overflow: hidden;
}

.dimension-header {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  padding: var(--space-8) var(--space-8) 0;
}

.dimension-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 56px;
  height: 56px;
  border-radius: var(--radius-xl);
  color: white;
  flex-shrink: 0;
}

.dimension-icon.trust {
  background: linear-gradient(135deg, #10b981 0%, #059669 100%);
}

.dimension-icon.connect {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
}

.dimension-icon.enable {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
}

.dimension-icon.develop {
  background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.dimension-title h2 {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-1);
}

.dimension-title p {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

/* ===== å­éƒ¨åˆ† ===== */
.subsection {
  padding: var(--space-6) var(--space-8);
  border-top: 1px solid var(--border-light);
}

.subsection:first-of-type {
  border-top: none;
}

.subsection-title {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-6);
  padding-bottom: var(--space-2);
  border-bottom: 2px solid var(--primary-100);
}

.question-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.question-item {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.question-label {
  font-size: 0.875rem;
  color: var(--text-primary);
  line-height: 1.5;
  font-weight: 500;
}

.rating-group {
  display: flex;
  gap: var(--space-2);
  flex-wrap: wrap;
}

.rating-option {
  cursor: pointer;
}

.rating-option input {
  display: none;
}

.rating-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border: 2px solid var(--border-medium);
  border-radius: var(--radius-lg);
  font-weight: 600;
  color: var(--text-secondary);
  transition: all var(--duration-fast) var(--ease-out);
  background: var(--bg-primary);
}

.rating-option:hover .rating-button {
  border-color: var(--primary-300);
  color: var(--primary-600);
  transform: scale(1.05);
}

.rating-option input:checked + .rating-button {
  background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
  border-color: var(--primary-500);
  color: white;
  transform: scale(1.1);
}

/* ===== æäº¤åŒºåŸŸ ===== */
.submit-section {
  background: var(--bg-primary);
  border-radius: var(--radius-2xl);
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-light);
  padding: var(--space-8);
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
  align-items: center;
}

.progress-info {
  width: 100%;
  max-width: 400px;
  text-align: center;
}

.progress-text {
  font-size: 0.875rem;
  color: var(--text-secondary);
  font-weight: 500;
  margin-bottom: var(--space-2);
  display: block;
}

.progress-bar {
  height: 8px;
  background: var(--gray-200);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary-500) 0%, var(--primary-600) 100%);
  border-radius: var(--radius-sm);
  transition: width var(--duration-normal) var(--ease-out);
}

/* ===== ç»“æœåŒºåŸŸ ===== */
.results-section {
  padding: var(--space-16) 0 var(--space-24);
}

.result-card {
  background: var(--bg-primary);
  border-radius: var(--radius-2xl);
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-light);
  margin-bottom: var(--space-8);
  overflow: hidden;
}

.card-header {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  padding: var(--space-8) var(--space-8) 0;
}

.card-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--primary-500) 0%, var(--primary-600) 100%);
  border-radius: var(--radius-xl);
  color: white;
  flex-shrink: 0;
}

.card-title h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-1);
}

.card-title p {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

/* ===== è¯„åˆ†æ€»ç»“ ===== */
.score-summary {
  padding: var(--space-8);
}

.total-score {
  display: flex;
  align-items: center;
  gap: var(--space-6);
  margin-bottom: var(--space-8);
  padding-bottom: var(--space-6);
  border-bottom: 1px solid var(--border-light);
}

.score-circle {
  display: flex;
  align-items: baseline;
  gap: var(--space-1);
}

.score-number {
  font-size: 3rem;
  font-weight: 700;
  color: var(--primary-600);
  line-height: 1;
}

.score-total {
  font-size: 1.25rem;
  color: var(--text-tertiary);
  font-weight: 500;
}

.score-info h4 {
  font-size: 1.125rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-2);
}

.level-badge {
  padding: var(--space-2) var(--space-4);
  border-radius: var(--radius-2xl);
  font-size: 0.875rem;
  font-weight: 600;
}

.level-badge.excellent {
  background: #dcfce7;
  color: #166534;
}

.level-badge.good {
  background: #dbeafe;
  color: #1e40af;
}

.level-badge.basic {
  background: #fef3c7;
  color: #92400e;
}

.level-badge.needs-improvement {
  background: #fecaca;
  color: #991b1b;
}

.dimension-scores {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.dimension-score-item {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}

.score-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.dimension-name {
  font-size: 0.875rem;
  font-weight: 500;
  color: var(--text-primary);
}

.score-value {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text-secondary);
}

.score-bar {
  height: 8px;
  background: var(--gray-200);
  border-radius: var(--radius-sm);
  overflow: hidden;
}

.score-fill {
  height: 100%;
  border-radius: var(--radius-sm);
  transition: width 1s ease-out;
}

.score-fill.trust {
  background: linear-gradient(90deg, #10b981 0%, #059669 100%);
}

.score-fill.connect {
  background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
}

.score-fill.enable {
  background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
}

.score-fill.develop {
  background: linear-gradient(90deg, #8b5cf6 0%, #7c3aed 100%);
}

/* ===== å¼ºé¡¹å±•ç¤º ===== */
.strength-content {
  padding: var(--space-8);
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.strength-item {
  padding: var(--space-6);
  border-radius: var(--radius-xl);
  border: 1px solid #d1fae5;
  background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
}

.strength-header {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin-bottom: var(--space-3);
  flex-wrap: wrap;
}

.strength-badge {
  padding: var(--space-1) var(--space-3);
  border-radius: var(--radius-2xl);
  font-size: 0.75rem;
  font-weight: 600;
  background: #059669;
  color: white;
}

.strength-header h4 {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
  flex: 1;
}

.strength-score {
  font-size: 0.875rem;
  font-weight: 600;
  color: #059669;
  background: white;
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-md);
}

.strength-description {
  font-size: 0.875rem;
  color: var(--text-secondary);
  line-height: 1.5;
}

.strength-icon {
  background: linear-gradient(135deg, #059669 0%, #047857 100%) !important;
}

/* ===== æ”¹è¿›å»ºè®® ===== */
.improvement-content {
  padding: var(--space-8);
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.improvement-item {
  padding: var(--space-6);
  border-radius: var(--radius-xl);
  border: 1px solid var(--border-light);
}

.improvement-item.priority-high {
  background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
  border-color: #fca5a5;
}

.improvement-item.priority-medium {
  background: linear-gradient(135deg, #fefbf2 0%, #fed7aa 100%);
  border-color: #fdba74;
}

.improvement-header {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin-bottom: var(--space-3);
  flex-wrap: wrap;
}

.priority-badge {
  padding: var(--space-1) var(--space-3);
  border-radius: var(--radius-2xl);
  font-size: 0.75rem;
  font-weight: 600;
}

.priority-badge.high {
  background: #dc2626;
  color: white;
}

.priority-badge.medium {
  background: #d97706;
  color: white;
}

.improvement-header h4 {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-primary);
  flex: 1;
}

.improvement-score {
  font-size: 0.875rem;
  font-weight: 600;
  color: #dc2626;
  background: white;
  padding: var(--space-1) var(--space-2);
  border-radius: var(--radius-md);
}

.improvement-icon {
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
}

.improvement-description {
  font-size: 0.875rem;
  color: var(--text-secondary);
  line-height: 1.5;
}

/* ===== AIåˆ†æå†…å®¹ ===== */
.analysis-content {
  padding: var(--space-8);
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--text-secondary);
}

/* ===== ä¸ªæ€§åŒ–å»ºè®®æ ·å¼ ===== */
.personalized-icon {
  background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%) !important;
}

.personalized-content {
  background: linear-gradient(135deg, #fefbf2 0%, #fef3c7 100%);
  border: 1px solid #fed7aa;
  border-radius: var(--radius-xl);
  margin: var(--space-4);
  position: relative;
}

.personalized-content::before {
  content: 'ğŸ¯';
  position: absolute;
  top: var(--space-4);
  right: var(--space-4);
  font-size: 1.5rem;
  opacity: 0.6;
}

/* ===== ä¸ªæ€§åŒ–å‡çº§ ===== */
.personalization-upgrade {
  margin-bottom: var(--space-8);
}

.upgrade-card {
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  border: 1px solid #bae6fd;
  border-radius: var(--radius-2xl);
  padding: var(--space-8);
  text-align: center;
}

.upgrade-header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-4);
  margin-bottom: var(--space-6);
}

.upgrade-icon {
  font-size: 2rem;
}

.upgrade-content h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-2);
}

.upgrade-content p {
  font-size: 0.875rem;
  color: var(--text-secondary);
  line-height: 1.5;
}

.upgrade-actions {
  display: flex;
  justify-content: center;
  gap: var(--space-4);
  flex-wrap: wrap;
}

/* ===== ä¸ªæ€§åŒ–è¡¨å• ===== */
.personalization-form {
  margin-bottom: var(--space-8);
}

.form-card {
  background: var(--bg-primary);
  border-radius: var(--radius-2xl);
  box-shadow: var(--shadow-lg);
  border: 1px solid var(--border-light);
  overflow: hidden;
}

.form-header {
  background: linear-gradient(135deg, var(--primary-50) 0%, var(--primary-100) 100%);
  padding: var(--space-6) var(--space-8);
  text-align: center;
}

.form-header h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: var(--space-2);
}

.form-header p {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.form-content {
  padding: var(--space-8);
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.form-label {
  font-size: 0.875rem;
  font-weight: 600;
  color: var(--text-primary);
}

.radio-group, .checkbox-group {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-3);
}

.radio-option, .checkbox-option {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2) var(--space-4);
  border: 1px solid var(--border-medium);
  border-radius: var(--radius-lg);
  cursor: pointer;
  transition: all var(--duration-fast) var(--ease-out);
  background: var(--bg-primary);
}

.radio-option:hover, .checkbox-option:hover {
  border-color: var(--primary-300);
  background: var(--primary-50);
}

.radio-option input, .checkbox-option input {
  margin: 0;
}

.radio-option input:checked + span,
.checkbox-option input:checked + span {
  color: var(--primary-600);
  font-weight: 600;
}

.radio-option:has(input:checked),
.checkbox-option:has(input:checked) {
  border-color: var(--primary-500);
  background: var(--primary-100);
}

.form-actions {
  padding: var(--space-6) var(--space-8);
  background: var(--bg-secondary);
  display: flex;
  justify-content: center;
  gap: var(--space-4);
  flex-wrap: wrap;
}

/* ===== æ“ä½œæŒ‰é’® ===== */
.action-section {
  display: flex;
  justify-content: center;
  gap: var(--space-4);
}

/* ===== å“åº”å¼è®¾è®¡ ===== */
@media (max-width: 768px) {
  .upgrade-header {
    flex-direction: column;
    gap: var(--space-3);
  }

  .upgrade-actions {
    flex-direction: column;
    align-items: center;
  }

  .form-content {
    padding: var(--space-6);
  }

  .radio-group, .checkbox-group {
    flex-direction: column;
  }

  .form-actions {
    flex-direction: column;
    align-items: center;
  }
  .page-header {
    padding: var(--space-12) 0 var(--space-16);
  }

  .page-title {
    font-size: 2rem;
  }

  .page-description {
    font-size: 1rem;
  }

  .assessment-info {
    gap: var(--space-4);
  }

  .section-container {
    padding: 0 var(--space-4);
  }

  .assessment-section {
    margin-top: -var(--space-8);
  }

  .dimension-header {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-3);
  }

  .subsection {
    padding: var(--space-4) var(--space-6);
  }

  .rating-group {
    justify-content: center;
  }

  .total-score {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--space-4);
  }

  .improvement-content {
    padding: var(--space-6);
  }

  .analysis-content {
    padding: var(--space-6);
  }
}

@media (max-width: 640px) {
  .page-title {
    font-size: 1.75rem;
  }

  .dimension-header {
    padding: var(--space-6) var(--space-4) 0;
  }

  .subsection {
    padding: var(--space-4);
  }

  .submit-section {
    padding: var(--space-6);
  }

  .rating-button {
    width: 36px;
    height: 36px;
    font-size: 0.875rem;
  }
}

/* ===== åŠ¨ç”»å»¶è¿Ÿ ===== */
.animate-fade-in-up {
  animation-fill-mode: both;
}

.dimension-card:nth-child(1) { animation-delay: 0.1s; }
.dimension-card:nth-child(2) { animation-delay: 0.2s; }
.dimension-card:nth-child(3) { animation-delay: 0.3s; }
.dimension-card:nth-child(4) { animation-delay: 0.4s; }

.result-card:nth-child(1) { animation-delay: 0.1s; }
.result-card:nth-child(2) { animation-delay: 0.2s; }
.result-card:nth-child(3) { animation-delay: 0.3s; }
</style>